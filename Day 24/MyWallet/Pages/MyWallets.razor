@page "/"
@using MyWallet.Models
@using MyWallet.Components

<div class="container py-5">
    <div class="card mx-auto" style="max-width: 500px; background: #23272b; color: #fff;">
        <div class="card-body text-center">
            <h2>My Wallet</h2>
            <h1 class="fw-bold" style="color: #ffe600;">@Balance.ToString("C2")</h1>
            <div>Total balance</div>
            <div class="my-3">
                <button class="btn btn-success me-2" @onclick="ShowDeposit">Deposit</button>
                <button class="btn btn-danger" @onclick="ShowWithdraw">Withdraw</button>
            </div>
            <h4 class="mt-4">Transaction History</h4>
            <div class="mt-2">
                <table class="table table-bordered" style="background: transparent;">
                    <tbody>
                        @foreach (var t in Transactions.OrderByDescending(x => x.Time))
                        {
                            <tr class="@(t.Type == "Deposit" ? "table-success" : "table-danger")">
                                <td>@t.Type</td>
                                <td>@t.Amount.ToString("C2")</td>
                                <td>@t.Time.ToString("dd MMM h:mmtt").ToLower()</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<ModalWallet Title="Deposit Money" Show="@ShowDepositModal" ShowChanged="@((bool v) => ShowDepositModal = v)"
    OnSubmit="Deposit" TotalBalance="@Balance" />
<ModalWallet Title="Withdraw Money" Show="@ShowWithdrawModal" ShowChanged="@((bool v) => ShowWithdrawModal = v)"
    OnSubmit="Withdraw" TotalBalance="@Balance" />

@code {
    decimal Balance = 1000.00m;
    bool ShowDepositModal = false;
    bool ShowWithdrawModal = false;
    List<Transaction> Transactions = new()
{
new Transaction { Type = "Deposit", Amount = 1000, Time = DateTime.Now.AddHours(-2) },
};

    void ShowDeposit() => ShowDepositModal = true;
    void ShowWithdraw() => ShowWithdrawModal = true;

    void Deposit(decimal amount)
    {
        if (amount > 0)
        {
            Balance += amount;
            Transactions.Add(new Transaction { Type = "Deposit", Amount = amount, Time = DateTime.Now });
        }
    }

    void Withdraw(decimal amount)
    {
        if (amount > 0 && amount <= Balance)
        {
            Balance -= amount;
            Transactions.Add(new Transaction { Type = "Withdraw", Amount = amount, Time = DateTime.Now });
        }
    }
}